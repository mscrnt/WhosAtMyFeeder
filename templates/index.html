{% extends "base.html" %}

{% block title %}
    Recent Detections
{% endblock %}

{% block date_picker %}
  <form class="d-flex">
      <input type="date" id="date-picker" class="form-control" value="{{ date }}" min="{{ earliest_date }}" max="{{ date }}" onchange="navigateToDailySummary(this)" />
  </form>
{% endblock %}

{% block content %}
    <h2>Recent Detections</h2>
    <div class="row row-cols-2 row-cols-md-4 row-cols-lg-6 g-3 photo-grid">
        {% for detection in recent_detections %}
        <div class="col">
            <div class="card h-100 border-0 shadow-sm position-relative">
                <img src="{{ url_for('frigate_thumbnail', frigate_event=detection.frigate_event) }}" alt="Thumbnail" class="card-img-top thumbnail" onload="checkTransparentImage(this)" onclick="showVideoDirect('{{ url_for('frigate_clip', frigate_event=detection.frigate_event) }}')"/>
                <span class="play-icon"><i class="fa-solid fa-circle-play"></i></span>
                <div class="card-body p-2">
                    <p class="card-text text-center mb-0">{{ detection.common_name }}</p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <h2>Detection Summary</h2>
    <table class="table table-hover table-striped">
        <thead>
        <tr>
            <th scope="col">Common Name</th>
            <th scope="col">Total</th>
            {% for hour in range(current_hour + 1) %}
                <th scope="col">
                    <a href="{{ url_for('show_detections_by_hour', date=date, hour=hour) }}"
                       class="text-decoration-none text-reset">
                        {{ hour }}
                    </a>
                </th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for species in daily_summary.values() %}
            <tr>
                <td>
                    <a href="{{ url_for('show_detections_by_scientific_name', scientific_name=species.scientific_name, date=date, end_date=None) }}"
                       class="text-decoration-none text-reset">
                        {{ species.common_name }}
                    </a>
                </td>
                <td>{{ species.total_detections }}</td>
                {% for detections in species.hourly_detections[:current_hour + 1] %}
                    <td>
                        {% if detections > 0 %}
                            {{ detections }}
                        {% endif %}
                    </td>
                {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>

    {% include 'modals_and_scripts.html' %}
{% endblock %}

{% block scripts %}
    <script>
        function navigateToDailySummary(input) {
            const selectedDate = input.value;
            window.location.href = `/daily_summary/${selectedDate}`;
        }
    </script>
{% endblock %}